<script>
function isValidIPv4(ip) {
    const parts = ip.split(".");
    if (parts.length !== 4) return false;

    for (let part of parts) {
        if (!/^\d+$/.test(part)) return false;
        const num = parseInt(part, 10);
        if (num < 0 || num > 255) return false;
    }

    return true;
}

function isValidPort(port) {
    if (!/^\d+$/.test(port)) return false;
    const num = parseInt(port, 10);
    return num >= 1 && num <= 65535;
}

let path = window.location.pathname;

// Remove leading slash
if (path.startsWith("/")) {
    path = path.substring(1);
}

// Remove repo name if needed
const repoName = "steamconnector";
if (path.startsWith(repoName + "/")) {
    path = path.substring(repoName.length + 1);
}

// Decode safely
path = decodeURIComponent(path);

// Validate format IP:PORT
if (path.includes(":")) {
    const [ip, port] = path.split(":");

    if (isValidIPv4(ip) && isValidPort(port)) {

        // Safe text injection
        document.getElementById("serverText").textContent = ip + ":" + port;

        const steamLink = "steam://connect/" + ip + ":" + port;

        setTimeout(() => {
            window.location.href = steamLink;
        }, 500);

    } else {
        showError();
    }
} else {
    showError();
}

function showError() {
    document.body.innerHTML = `
        <h1>Invalid Server Address</h1>
        <p>Use format: IP:PORT</p>
    `;
}
</script>